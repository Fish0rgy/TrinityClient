using Trinity.Utilities;
using Trinity.SDK;
using MelonLoader;
using System.Collections;
using UnityEngine;
using VRC.SDKBase;

namespace Trinity.Module.Exploit
{
    class UdonExploitFinder : BaseModule
    {
        public UdonExploitFinder() : base("Udon\n Exploit Finder", "Spams Every Udon Object In The World", Main.Instance.udonexploitbutton, null, true, false)
        {
        }
        public override void OnEnable()
        {
            MelonCoroutines.Start(this.UdonFinder());
        }
         
        public override void OnDisable()
        {
            MelonCoroutines.Stop(this.UdonFinder());
        }

        IEnumerator UdonFinder()
        {
            while (this.toggled)
            {
                for (int i = 0; i < PU.GetAllPlayers().Length; i++)
                {
                    for (int j = 0; j < WorldWrapper.udonBehaviours.Length; j++)
                    {
                        foreach (string name in WorldWrapper.udonBehaviours[j]._eventTable.Keys)
                        {
                            if (!name.StartsWith("_"))
                            {
                                UW.udonsend(name, EventTarget.Local);
                                LogHandler.Log(LogHandler.Colors.Green, $"Key: {name} | Object: {WorldWrapper.udonBehaviours[j].gameObject.name}", false, false);
                            } 
                            yield return new WaitForSeconds(0.25f);
                        }
                        yield return new WaitForSeconds(0.25f);
                        if (!this.toggled)
                            break;
                    }
                }
                yield return new WaitForSeconds(0.25f);
            }
            yield break;
        }
    }
}
